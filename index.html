<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Plan de Trabajo</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .table-input {
            width: 100%;
            padding: 0.5rem;
            border: 1px solid #D1D5DB;
            border-radius: 0.375rem;
        }
        .add-btn, .remove-btn {
            padding: 0.5rem 1rem;
            border-radius: 0.375rem;
            cursor: pointer;
            font-weight: 500;
            transition: background-color 0.2s;
        }
        .add-btn {
            background-color: #10B981;
            color: white;
        }
        .add-btn:hover {
            background-color: #059669;
        }
        .remove-btn {
            background-color: #EF4444;
            color: white;
        }
        .remove-btn:hover {
            background-color: #DC2626;
        }
    </style>
</head>
<body class="bg-gray-100 p-4 sm:p-6 lg:p-8">
    <div class="max-w-5xl mx-auto bg-white p-8 rounded-lg shadow-md">
        <h1 class="text-2xl font-bold text-gray-800 mb-6 text-center">PLAN DE TRABAJO</h1>

        <!-- Título Principal -->
        <div class="mb-6">
            <label for="main-title" class="block text-sm font-medium text-gray-700 mb-2">Título del Plan de Trabajo</label>
            <textarea id="main-title" name="main-title" rows="3" class="w-full p-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500" placeholder="Ej: MANTENIMIENTO DE ESTACIONES E IMPLEMENTACION DE SENSORES...">“MANTENIMIENTO DE ESTACIONES E IMPLEMENTACION DE SENSORES DE PRECIPITACION EN EL MARCO DEL PROGRAMA DE LLUVIAS INTENSAS PARA LAS ESTACIONES DE CO CABANILLAS Y CO LAMPA (DZ13) ”</textarea>
        </div>

        <!-- Justificación -->
        <div class="mb-6">
            <label for="justificacion" class="block text-sm font-medium text-gray-700 mb-2">1. Justificación</label>
            <textarea id="justificacion" name="justificacion" rows="4" class="w-full p-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500" placeholder="Describa la justificación del proyecto..."></textarea>
        </div>

        <!-- Objetivo -->
        <div class="mb-6">
            <label for="objetivo" class="block text-sm font-medium text-gray-700 mb-2">2. Objetivo</label>
            <textarea id="objetivo" name="objetivo" rows="4" class="w-full p-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500" placeholder="Describa el objetivo del proyecto..."></textarea>
        </div>

        <!-- Participantes -->
        <div class="mb-6">
            <h2 class="text-lg font-semibold text-gray-800 mb-4">3. Participantes en la comisión de servicio</h2>
            <table class="w-full">
                <thead>
                    <tr class="bg-gray-50">
                        <th class="p-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">N°</th>
                        <th class="p-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Nombres y Apellidos</th>
                        <th class="p-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">OFICINA / DZ</th>
                        <th class="p-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Cargo</th>
                        <th class="p-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">DNI</th>
                        <th class="p-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Teléfono</th>
                        <th class="p-2"></th>
                    </tr>
                </thead>
                <tbody id="participantes-tbody">
                    <!-- Filas de participantes se agregarán aquí -->
                </tbody>
            </table>
            <button onclick="agregarParticipante()" class="add-btn mt-4">Agregar Participante</button>
        </div>

        <!-- Ubicación de las estaciones -->
        <div class="mb-6">
            <h2 class="text-lg font-semibold text-gray-800 mb-4">4. Ubicación de las estaciones</h2>
            <table class="w-full">
                <thead>
                    <tr class="bg-gray-50">
                        <th class="p-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">N°</th>
                        <th class="p-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Estación</th>
                        <th class="p-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Departamento</th>
                        <th class="p-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Provincia</th>
                        <th class="p-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Distrito</th>
                        <th class="p-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Latitud</th>
                        <th class="p-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Longitud</th>
                        <th class="p-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Altitud</th>
                        <th class="p-2"></th>
                    </tr>
                </thead>
                <tbody id="estaciones-tbody">
                    <!-- Filas de estaciones se agregarán aquí -->
                </tbody>
            </table>
            <button onclick="agregarEstacion()" class="add-btn mt-4">Agregar Estación</button>
        </div>

        <!-- Período de la comisión -->
        <div class="mb-6">
            <h2 class="text-lg font-semibold text-gray-800 mb-4">5. Período de la comisión</h2>
            <div class="overflow-x-auto">
                <table class="w-full">
                    <thead>
                        <tr class="bg-gray-50">
                            <th class="p-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">N°</th>
                            <th class="p-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Nombres y Apellidos</th>
                            <th class="p-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">OFICINA / DZ</th>
                            <th class="p-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Fecha de Salida</th>
                            <th class="p-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Detalles Salida</th>
                            <th class="p-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Fecha de Retorno</th>
                            <th class="p-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Detalles Retorno</th>
                        </tr>
                    </thead>
                    <tbody id="periodo-tbody">
                        <!-- Filas generadas dinámicamente -->
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Ruta de la comisión -->
        <div class="mb-6">
            <label for="ruta" class="block text-sm font-medium text-gray-700 mb-2">6. Ruta de la comisión</label>
            <textarea id="ruta" name="ruta" rows="4" class="w-full p-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500" placeholder="Describa la ruta..."></textarea>
        </div>

        <!-- Materiales/vehículos requeridos -->
        <div class="mb-6">
            <h2 class="text-lg font-semibold text-gray-800 mb-4">7. Materiales/vehículos requeridos</h2>
            
            <h3 class="font-medium text-gray-700 mb-2 mt-4">7.1 Herramientas e instrumentos requeridos</h3>
            <table class="w-full">
                <thead>
                    <tr class="bg-gray-50">
                        <th class="p-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">N°</th>
                        <th class="p-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Descripción</th>
                        <th class="p-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Cantidad</th>
                        <th class="p-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Utilidad</th>
                        <th class="p-2"></th>
                    </tr>
                </thead>
                <tbody id="herramientas-tbody"></tbody>
            </table>
            <button onclick="agregarHerramienta()" class="add-btn mt-4">Agregar Herramienta</button>

            <h3 class="font-medium text-gray-700 mb-2 mt-6">7.2 Repuestos a emplear</h3>
            <table class="w-full">
                <thead>
                    <tr class="bg-gray-50">
                        <th class="p-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">N°</th>
                        <th class="p-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Descripción</th>
                        <th class="p-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Marca</th>
                        <th class="p-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Modelo</th>
                        <th class="p-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Cantidad</th>
                        <th class="p-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Comentario</th>
                        <th class="p-2"></th>
                    </tr>
                </thead>
                <tbody id="repuestos-tbody"></tbody>
            </table>
            <button onclick="agregarRepuesto()" class="add-btn mt-4">Agregar Repuesto</button>
        </div>

        <!-- Plan de actividades -->
        <div class="mb-6">
            <h2 class="text-lg font-semibold text-gray-800 mb-4">8. Plan de actividades</h2>
            <table class="w-full">
                <thead>
                    <tr class="bg-gray-50">
                        <th class="p-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Día</th>
                        <th class="p-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Fecha</th>
                        <th class="p-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Descripción</th>
                    </tr>
                </thead>
                <tbody id="actividades-tbody"></tbody>
            </table>
        </div>

        <!-- Presupuesto -->
        <div class="mb-6">
            <h2 class="text-lg font-semibold text-gray-800 mb-4">9. Presupuesto Requerido</h2>
            <h3 class="font-medium text-gray-700 mb-2 mt-4">9.1 Gastos para comisión de servicio</h3>
             <table class="w-full">
                <thead>
                    <tr class="bg-gray-50">
                        <th class="p-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Descripción</th>
                        <th class="p-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Unidad</th>
                        <th class="p-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Cant.</th>
                        <th class="p-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Precio Unit.</th>
                        <th class="p-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Total S/.</th>
                        <th class="p-2"></th>
                    </tr>
                </thead>
                <tbody id="gastos-tbody"></tbody>
            </table>
            <button onclick="agregarGasto()" class="add-btn mt-4">Agregar Gasto</button>

            <h3 class="font-medium text-gray-700 mb-2 mt-6">9.2 Gasto por encargo</h3>
            <table class="w-full">
                <thead>
                    <tr class="bg-gray-50">
                        <th class="p-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Item</th>
                        <th class="p-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Descripción</th>
                        <th class="p-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Cantidad</th>
                        <th class="p-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Precio Unit. (S/.)</th>
                        <th class="p-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Total (S/.)</th>
                        <th class="p-2"></th>
                    </tr>
                </thead>
                <tbody id="encargo-tbody"></tbody>
            </table>
            <button onclick="agregarEncargo()" class="add-btn mt-4">Agregar Encargo</button>
        </div>

        <!-- Conclusiones -->
        <div class="mb-6">
            <label for="conclusiones" class="block text-sm font-medium text-gray-700 mb-2">10. Conclusiones</label>
            <textarea id="conclusiones" name="conclusiones" rows="5" class="w-full p-2 border border-gray-300 rounded-md shadow-sm focus:ring-indigo-500 focus:border-indigo-500" placeholder="Escriba las conclusiones..."></textarea>
        </div>

        <!-- Fecha y Botones -->
        <div class="flex justify-between items-center mt-8">
            <div>
                <label for="fecha-documento" class="block text-sm font-medium text-gray-700">Fecha del Documento</label>
                <input type="date" id="fecha-documento" name="fecha-documento" class="mt-1 p-2 border border-gray-300 rounded-md">
            </div>
            <div class="flex gap-4">
                <button class="bg-gray-600 text-white font-bold py-2 px-6 rounded-lg hover:bg-gray-700 transition duration-300">Guardar Borrador</button>
                <button class="bg-blue-600 text-white font-bold py-2 px-6 rounded-lg hover:bg-blue-700 transition duration-300" onclick="window.print()">Imprimir / Guardar PDF</button>
            </div>
        </div>
    </div>

    <script>
        // Funciones para añadir y eliminar filas en las tablas
        function agregarFila(tbodyId, celdasHtml) {
            const tbody = document.getElementById(tbodyId);
            const newRow = tbody.insertRow();
            newRow.innerHTML = celdasHtml;
            renumerarTabla(tbodyId);
        }

        function eliminarFila(button, isParticipant = false) {
            const row = button.parentNode.parentNode;
            const tbody = row.parentNode;
            const tbodyId = tbody.id;
            row.parentNode.removeChild(row);
            renumerarTabla(tbodyId);
            if (isParticipant) {
                actualizarPeriodoComision();
            }
        }
        
        function renumerarTabla(tbodyId) {
             const tablesToRenumber = [
                'participantes-tbody', 'estaciones-tbody', 'herramientas-tbody', 
                'repuestos-tbody', 'encargo-tbody', 'periodo-tbody'
             ];
             if (!tablesToRenumber.includes(tbodyId)) return;

             const tbody = document.getElementById(tbodyId);
             if (tbody && tbody.rows.length > 0) {
                 for (let i = 0; i < tbody.rows.length; i++) {
                     tbody.rows[i].cells[0].textContent = i + 1;
                 }
             }
        }

        function actualizarPeriodoComision() {
            const participantesTbody = document.getElementById('participantes-tbody');
            const periodoTbody = document.getElementById('periodo-tbody');
            
            // 1. Guardar los datos existentes de la tabla de período
            const periodoData = [];
            for (let i = 0; i < periodoTbody.rows.length; i++) {
                const row = periodoTbody.rows[i];
                periodoData.push({
                    salida: row.cells[3].querySelector('input').value,
                    detallesSalida: row.cells[4].querySelector('textarea').value,
                    retorno: row.cells[5].querySelector('input').value,
                    detallesRetorno: row.cells[6].querySelector('textarea').value
                });
            }

            // 2. Limpiar y reconstruir la tabla de período
            periodoTbody.innerHTML = ''; 

            for (let i = 0; i < participantesTbody.rows.length; i++) {
                const participanteRow = participantesTbody.rows[i];
                const nombreInput = participanteRow.cells[1].querySelector('input');
                const oficinaInput = participanteRow.cells[2].querySelector('input');
                
                const nombre = nombreInput ? nombreInput.value : '';
                const oficina = oficinaInput ? oficinaInput.value : '';

                // Restaurar datos guardados si existen
                const data = periodoData[i] || {};

                const newRow = periodoTbody.insertRow();
                newRow.innerHTML = `
                    <td>${i + 1}</td>
                    <td><input type="text" class="table-input" value="${nombre}" readonly></td>
                    <td><input type="text" class="table-input" value="${oficina}" readonly></td>
                    <td><input type="date" class="table-input" value="${data.salida || ''}" onchange="actualizarPlanActividades()"></td>
                    <td><textarea class="table-input" rows="1">${data.detallesSalida || ''}</textarea></td>
                    <td><input type="date" class="table-input" value="${data.retorno || ''}" onchange="actualizarPlanActividades()"></td>
                    <td><textarea class="table-input" rows="1">${data.detallesRetorno || ''}</textarea></td>
                `;
            }
            actualizarPlanActividades();
        }

        function actualizarPlanActividades() {
            const periodoTbody = document.getElementById('periodo-tbody');
            const actividadesTbody = document.getElementById('actividades-tbody');
            actividadesTbody.innerHTML = ''; 

            const startDates = Array.from(periodoTbody.querySelectorAll('td:nth-child(4) input[type="date"]'))
                                    .map(input => input.value).filter(Boolean)
                                    .map(date => new Date(date + 'T00:00:00'));

            const returnDates = Array.from(periodoTbody.querySelectorAll('td:nth-child(6) input[type="date"]'))
                                     .map(input => input.value).filter(Boolean)
                                     .map(date => new Date(date + 'T00:00:00'));

            if (startDates.length === 0 || returnDates.length === 0) return;

            const minDate = new Date(Math.min.apply(null, startDates));
            const maxDate = new Date(Math.max.apply(null, returnDates));

            if (isNaN(minDate.getTime()) || isNaN(maxDate.getTime()) || minDate > maxDate) return;

            let currentDate = new Date(minDate);
            let dayCounter = 1;

            while (currentDate <= maxDate) {
                const newRow = actividadesTbody.insertRow();
                const formattedDate = currentDate.toISOString().split('T')[0];
                newRow.innerHTML = `
                    <td>Día ${dayCounter}</td>
                    <td><input type="text" class="table-input" value="${formattedDate}" readonly></td>
                    <td><textarea class="table-input" rows="2"></textarea></td>
                `;
                currentDate.setDate(currentDate.getDate() + 1);
                dayCounter++;
            }
        }

        // --- Funciones específicas para cada tabla ---
        
        function agregarParticipante() {
            const tbody = document.getElementById('participantes-tbody');
            const newRow = tbody.insertRow();
            newRow.innerHTML = `
                <td></td>
                <td><input type="text" class="table-input" oninput="actualizarPeriodoComision()"></td>
                <td><input type="text" class="table-input" oninput="actualizarPeriodoComision()"></td>
                <td><input type="text" class="table-input"></td>
                <td><input type="text" class="table-input"></td>
                <td><input type="text" class="table-input"></td>
                <td class="text-center"><button onclick="eliminarFila(this, true)" class="remove-btn">X</button></td>
            `;
            renumerarTabla('participantes-tbody');
            actualizarPeriodoComision();
        }

        function agregarEstacion() {
            const html = `
                <td></td>
                <td><input type="text" class="table-input"></td>
                <td><input type="text" class="table-input"></td>
                <td><input type="text" class="table-input"></td>
                <td><input type="text" class="table-input"></td>
                <td><input type="text" class="table-input"></td>
                <td><input type="text" class="table-input"></td>
                <td><input type="text" class="table-input"></td>
                <td class="text-center"><button onclick="eliminarFila(this)" class="remove-btn">X</button></td>
            `;
            agregarFila('estaciones-tbody', html);
        }

        function agregarHerramienta() {
             const html = `
                <td></td>
                <td><input type="text" class="table-input"></td>
                <td><input type="number" class="table-input" style="width: 80px;"></td>
                <td><input type="text" class="table-input"></td>
                <td class="text-center"><button onclick="eliminarFila(this)" class="remove-btn">X</button></td>
            `;
            agregarFila('herramientas-tbody', html);
        }
        
        function agregarRepuesto() {
             const html = `
                <td></td>
                <td><input type="text" class="table-input"></td>
                <td><input type="text" class="table-input"></td>
                <td><input type="text" class="table-input"></td>
                <td><input type="number" class="table-input" style="width: 80px;"></td>
                <td><input type="text" class="table-input"></td>
                <td class="text-center"><button onclick="eliminarFila(this)" class="remove-btn">X</button></td>
            `;
            agregarFila('repuestos-tbody', html);
        }
        
        function agregarGasto() {
            const html = `
                <td><input type="text" class="table-input"></td>
                <td><input type="text" class="table-input"></td>
                <td><input type="number" class="table-input"></td>
                <td><input type="number" step="0.01" class="table-input"></td>
                <td><input type="number" step="0.01" class="table-input"></td>
                <td class="text-center"><button onclick="eliminarFila(this)" class="remove-btn">X</button></td>
            `;
            agregarFila('gastos-tbody', html);
        }

        function agregarEncargo() {
            const html = `
                <td></td>
                <td><input type="text" class="table-input"></td>
                <td><input type="number" class="table-input"></td>
                <td><input type="number" step="0.01" class="table-input"></td>
                <td><input type="number" step="0.01" class="table-input"></td>
                <td class="text-center"><button onclick="eliminarFila(this)" class="remove-btn">X</button></td>
            `;
            agregarFila('encargo-tbody', html);
        }

        // Cargar datos iniciales de ejemplo
        window.onload = function() {
            // Participantes
            agregarParticipante();
            // Estaciones
            agregarEstacion();
            // Herramientas
            agregarHerramienta();
            // Repuestos
            agregarRepuesto();
            // Gastos
            agregarGasto();
            // Encargos
            agregarEncargo();
        };
    </script>
</body>
</html>
